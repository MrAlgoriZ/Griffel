# Гриффель

Telegram бот, построенный на aiogram, который предоставляет AI-powered разговоры, настраиваемые параметры и административный контроль.

## Функции

- **AI Разговоры**: Взаимодействуйте с различными AI моделями (SMART, AGRESSIVE, KAWAII и т.д.) используя команду `/ask`
- **Настраиваемые Параметры**: Администраторы могут настраивать поведение бота для каждого чата:
  - Длина истории (макс 10 без премиума, 25 с премиумом)
  - Режим бота (предопределенные модели или кастомный)
  - Кастомные промпты (премиум функция)
  - Имя бота
  - Ключ OpenRouter API
- **Интеграция с Базой Данных**: PostgreSQL бэкенд с OOP абстракцией Table
- **История Сообщений**: История разговоров для каждого чата с настраиваемой длиной
- **Административный Контроль**: Ограниченный доступ к конфигурации для администраторов чата
- **Премиум Функции**: Расширенные лимиты и редактирование кастомных промптов

## Установка

### Предварительные Требования
- Python 3.8+
- PostgreSQL база данных
- Telegram Bot Token
- OpenRouter API ключ (опционально, для улучшенных AI ответов)

### Настройка
1. Клонируйте репозиторий:
   ```bash
   git clone <repository-url>
   cd declist-bot
   ```

2. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

3. Создайте файл `.env` со следующими переменными:
   ```env
   TELEGRAM_TOKEN=ваш_telegram_bot_token
   OPEN_ROUTER_TOKEN=ваш_openrouter_api_ключ
   DATABASE_USER=ваш_db_пользователь
   DATABASE_USER_PASSWORD=ваш_db_пароль
   DATABASE_NAME=ваш_db_имя
   DATABASE_HOST=ваш_db_хост
   TABLE_NAME=chat_configs
   ```

4. Настройте таблицу базы данных:
   ```sql
   CREATE TABLE chat_configs (
       id BIGINT PRIMARY KEY,
       prompt TEXT,
       historyMaxlen SMALLINT DEFAULT 10,
       isPremium BOOLEAN DEFAULT FALSE,
       botName TEXT,
       botMode TEXT DEFAULT 'SMART',
       chatRules TEXT,
       openRouterKey TEXT
   );
   ```

5. Запустите бота:
   ```bash
   python main.py
   ```

## Использование

### Команды
- `/start` - Приветственное сообщение
- `/help` - Информация о помощи
- `/config` - Открыть меню конфигурации (только администраторы)
- `/ask <вопрос>` - Задать вопрос AI
- `/kick` - Исключить пользователя
- `/ban <время>` - Забанить пользователя
- `/mute <время>` - Замутить пользователя

### Конфигурация
Используйте `/config` для доступа к inline клавиатуре настроек:
- **Длина Истории**: Установить размер истории разговора (1, 5, 10 или кастомный)
- **Режим Бота**: Выбрать из предопределенных моделей (SMART, AGRESSIVE, KAWAII) или CUSTOM
- **Кастомный Промпт**: Редактировать системный промпт (только премиум)
- **Имя Бота**: Установить отображаемое имя (макс 15 символов)
- **Ключ OpenRouter**: Предоставить API ключ для лучших ответов

### AI Модели
- **SMART**: Сбалансированные, умные ответы
- **AGRESSIVE**: Более прямые и assertive ответы
- **KAWAII**: Милый и дружелюбный стиль
- **CUSTOM**: Использовать свой собственный системный промпт

## Архитектура

- **Роутеры**: Модульные обработчики для разных функций бота
  - `base_router`: Основные команды и конфигурация
  - `ai_router`: Обработка AI разговоров
  - `moderator_router`: Функции модерации
- **Слой Базы Данных**: OOP класс `Table` с асинхронными операциями PostgreSQL
- **AI Сервис**: Интеграция с OpenRouter API используя различные модели
- **Хранение**: In-memory история сообщений с настраиваемыми лимитами
- **Middleware**: Автоматическое логирование сообщений

## Вклад

1. Форкните репозиторий
2. Создайте ветку для функции
3. Внесите изменения
4. Добавьте тесты если применимо
5. Отправьте pull request

## Лицензия

Этот проект лицензирован под Apache лицензией - смотрите файл LICENSE для деталей.